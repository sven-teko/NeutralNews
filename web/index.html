<!doctype html>
<html lang="de" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NeutralNews – Themenvergleich</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/static/styles.css" rel="stylesheet">
  <style>
    /* ---- fixes ---- */
    /* make stretched-link work on both columns */
    .topic-card article { position: relative; }
    /* avoid any accidental clipping/truncation of words like "Jugend" */
    .topic-card .group-title,
    .topic-card .group-link,
    .topic-card .group-summary { overflow: visible; text-overflow: clip; white-space: normal; letter-spacing: normal; hyphens: auto; word-break: break-word; }

    /* better focus visibility */
    a:focus-visible, button:focus-visible, .topic-chip:focus-visible { outline: 2px solid var(--bs-primary); outline-offset: 2px; border-radius: .5rem; }

    /* subtle borders for inputs in dark mode */
    .input-group .form-control, .input-group-text { border-color: rgba(255,255,255,.25); }

    /* small cosmetic helpers */
    .glass { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 1rem; }
    .brand { font-weight: 700; }
  </style>
</head>
<body class="text-light d-flex flex-column">

  <nav class="navbar navbar-expand-md navbar-dark mt-3 container-xxl">
    <div class="container-fluid px-3">
      <a class="navbar-brand d-flex align-items-center gap-2 brand" href="#"><i class="bi bi-broadcast-pin"></i>NeutralNews</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Navigation umschalten"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navMain">
        <div class="ms-md-auto d-flex align-items-center gap-2 mt-3 mt-md-0">
          <div class="input-group">
            <span class="input-group-text bg-transparent border-end-0" id="search-label"><i class="bi bi-search" aria-hidden="true"></i></span>
            <input id="search" type="search" class="form-control bg-transparent border-start-0" placeholder="Suchen…" aria-labelledby="search-label" autocomplete="off">
            <button id="clearSearch" class="btn btn-outline-light" type="button" title="Suche löschen" aria-label="Suche löschen"><i class="bi bi-x-lg"></i></button>
          </div>
          <button id="refresh" class="btn btn-outline-light" type="button" title="Neu laden" aria-label="Neu laden"><i class="bi bi-arrow-repeat"></i></button>
        </div>
      </div>
    </div>
  </nav>

  <header class="container-xxl mt-4">
    <div class="p-3 glass">
      <div class="row align-items-center gy-2">
        <div class="col-lg-8">
          <h1 class="h4 brand mb-2">Themenvergleich auf einen Blick</h1>
          <p class="text-secondary mb-0">Suche und filtere, um passende Artikel zu finden.</p>
        </div>
        <div class="col-lg-4">
          <div id="topicBar" class="d-flex flex-wrap gap-2 justify-content-lg-end">
            <button class="btn btn-sm topic-chip rounded-pill px-3 active" data-topic="alle" type="button">Alle</button>
            <button class="btn btn-sm topic-chip rounded-pill px-3" data-topic="politik" type="button">Politik</button>
            <button class="btn btn-sm topic-chip rounded-pill px-3" data-topic="wirtschaft" type="button">Wirtschaft</button>
            <button class="btn btn-sm topic-chip rounded-pill px-3" data-topic="technologie" type="button">Technologie</button>
            <button class="btn btn-sm topic-chip rounded-pill px-3" data-topic="kultur" type="button">Kultur</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container-xxl my-4 flex-grow-1">
    <!-- SR status for screen readers -->
    <div id="sr-status" class="visually-hidden" aria-live="polite"></div>

    <template id="tpl-group">
      <div class="col-12">
        <section class="glass p-3 topic-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h2 class="h6 mb-0 group-title">Thema</h2>
            <span class="badge text-bg-secondary-subtle text-secondary-emphasis">Vergleich</span>
          </div>
          <div class="row g-2">
            <div class="col-12 col-lg-6">
              <article class="p-3 border rounded-3 bg-body bg-opacity-25" data-source="srf">
                <div class="d-flex align-items-center gap-2 mb-1">
                  <span class="badge rounded-pill text-bg-primary-subtle text-primary-emphasis">SRF</span>
                  <time class="text-secondary small group-time"></time>
                </div>
                <a class="stretched-link group-link fw-semibold" target="_blank" rel="noopener noreferrer"></a>
                <p class="mb-0 text-secondary group-summary"></p>
              </article>
            </div>
            <div class="col-12 col-lg-6">
              <article class="p-3 border rounded-3 bg-body bg-opacity-25" data-source="tagesschau">
                <div class="d-flex align-items-center gap-2 mb-1">
                  <span class="badge rounded-pill text-bg-success-subtle text-success-emphasis">Tagesschau</span>
                  <time class="text-secondary small group-time"></time>
                </div>
                <a class="stretched-link group-link fw-semibold" target="_blank" rel="noopener noreferrer"></a>
                <p class="mb-0 text-secondary group-summary"></p>
              </article>
            </div>
          </div>
        </section>
      </div>
    </template>

    <div id="groups" class="row g-3">
      <div class="col-12"><div class="glass p-3"><span class="text-secondary">Lade…</span></div></div>
    </div>
  </main>

  <footer class="container-xxl glass mt-auto mb-3">
    <div class="d-flex flex-wrap justify-content-between align-items-center px-3 py-2 small text-secondary">
      <span>© <span id="year"></span> NeutralNews</span>
      <div class="d-flex gap-3"></div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <script>
    const $ = s => document.querySelector(s);
    const state = { groups: [], topic: 'alle', q: '' };
    const fmt = d => { try { return new Date(d).toLocaleString(undefined,{dateStyle:'medium',timeStyle:'short'});} catch { return ''; } };

    // basic UI
    $('#year').textContent = new Date().getFullYear();
    $('#refresh')?.addEventListener('click', () => location.reload());
    $('#clearSearch')?.addEventListener('click', () => { $('#search').value = ''; state.q = ''; apply(); $('#search').focus(); });
    $('#search')?.addEventListener('keydown', e => { if(e.key === 'Escape'){ $('#clearSearch').click(); } });
    $('#topicBar')?.addEventListener('click', e => {
      const b = e.target.closest('.topic-chip'); if(!b) return;
      $('.topic-chip.active')?.classList.remove('active'); b.classList.add('active');
      document.dispatchEvent(new CustomEvent('nn:topic-change', { detail:{ topic: b.dataset.topic || 'alle' } }));
    });
    let t; $('#search')?.addEventListener('input', e => { clearTimeout(t); t = setTimeout(() => { state.q = e.target.value || ''; apply(); }, 200); });

    function render(list){
      const wrap = $('#groups'), tpl = $('#tpl-group'); if(!wrap||!tpl) return;
      wrap.innerHTML = '';
      if(!list.length){ wrap.innerHTML = '<div class="col-12"><div class="glass p-3"><span class="text-secondary">Keine Treffer.</span></div></div>'; $('#sr-status').textContent = 'Keine Treffer.'; return; }
      const frag = document.createDocumentFragment();
      list.forEach(g => {
        const node = tpl.content.cloneNode(true);
        node.querySelector('.group-title').textContent = g.keyword || 'Thema';
        const fill = (sel, item) => {
          const root = node.querySelector(sel); if(!root) return;
          const a = root.querySelector('.group-link');
          if(item){
            a.textContent = item.title || 'Zum Beitrag';
            a.href = item.url || '#';
            root.querySelector('.group-summary').textContent = item.summary || '';
            root.querySelector('.group-time').textContent = item.date ? fmt(item.date) : '';
          } else {
            a.textContent = 'Kein passender Beitrag';
            a.removeAttribute('href');
            a.classList.remove('stretched-link');
            root.querySelector('.group-summary').textContent = '';
            root.querySelector('.group-time').textContent = '';
          }
        };
        fill('[data-source="srf"]', g.srf);
        fill('[data-source="tagesschau"]', g.tagesschau);
        frag.appendChild(node);
      });
      wrap.appendChild(frag);
      $('#sr-status').textContent = list.length + ' Themenblöcke angezeigt.';
    }

    function apply(){
      const q = state.q.toLowerCase();
      let list = state.groups;
      if(state.topic !== 'alle') list = list.filter(g => (g.topic || 'alle') === state.topic);
      if(q) list = list.filter(g =>
        (g.keyword || '').toLowerCase().includes(q) ||
        (g.srf?.title || '').toLowerCase().includes(q) ||
        (g.srf?.summary || '').toLowerCase().includes(q) ||
        (g.tagesschau?.title || '').toLowerCase().includes(q) ||
        (g.tagesschau?.summary || '').toLowerCase().includes(q)
      );
      render(list);
    }

    // events (nur document – dein news.js feuert auf window UND document)
    document.addEventListener('nn:data', e => {
      if (Array.isArray(e?.detail?.groups)) { state.groups = e.detail.groups; apply(); }
    });
    document.addEventListener('nn:topic-change', e => { state.topic = e?.detail?.topic || 'alle'; apply(); });

    // Fallback, falls schon vorab gesetzt
    if (Array.isArray(window.NN_GROUPS) && window.NN_GROUPS.length){ state.groups = window.NN_GROUPS; apply(); }
  </script>

  <script src="/static/news.js" defer></script>
</body>
</html>
